<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="robots" content="all"><meta name="author" content="ç„¶éº¦"><link rel="icon" href="https://vuejs.press/images/hero.png"><title>Java BIO NIO AIO | ç„¶éº¦æ‚Ÿé“</title><meta name="description" content="åŠ©ä½ JavaæŠ€èƒ½æå‡">
    <link rel="preload" href="/assets/style-DYFyBbgL.css" as="style"><link rel="stylesheet" href="/assets/style-DYFyBbgL.css">
    <link rel="modulepreload" href="/assets/app-CANv46FP.js"><link rel="modulepreload" href="/assets/java_bio_nio_aio.html-CTfngeUB.js">
    <link rel="prefetch" href="/assets/index.html-CySrXDO1.js" as="script"><link rel="prefetch" href="/assets/vuepress-started.html-CD7QQDuT.js" as="script"><link rel="prefetch" href="/assets/index.html-DGa1n5ea.js" as="script"><link rel="prefetch" href="/assets/index.html-j8BDOr7h.js" as="script"><link rel="prefetch" href="/assets/index.html-MFud-EWV.js" as="script"><link rel="prefetch" href="/assets/index.html-UsSZJOGs.js" as="script"><link rel="prefetch" href="/assets/emoji.html-i2Qs4Y9w.js" as="script"><link rel="prefetch" href="/assets/package-info.html-Bg3C4gu3.js" as="script"><link rel="prefetch" href="/assets/index.html-FO8xO104.js" as="script"><link rel="prefetch" href="/assets/java_io_base.html-smpbSuN3.js" as="script"><link rel="prefetch" href="/assets/index.html-8uKadBdj.js" as="script"><link rel="prefetch" href="/assets/404.html-BXhn_byo.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="https://vuejs.press/images/hero.png" alt="ç„¶éº¦æ‚Ÿé“"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">ç„¶éº¦æ‚Ÿé“</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/base/" aria-label="è®¡ç®—æœºåŸºç¡€"><!---->è®¡ç®—æœºåŸºç¡€<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/java/" aria-label="JAVA"><!---->JAVA<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/middleware/" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/spring/" aria-label="Spring"><!---->Spring<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/base/" aria-label="è®¡ç®—æœºåŸºç¡€"><!---->è®¡ç®—æœºåŸºç¡€<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/java/" aria-label="JAVA"><!---->JAVA<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/middleware/" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/spring/" aria-label="Spring"><!---->Spring<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Java BIO NIO AIO <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="java-bio-nio-aio" tabindex="-1"><a class="header-anchor" href="#java-bio-nio-aio"><span>Java BIO NIO AIO</span></a></h1><blockquote><p>åŸæ–‡: <a href="https://mp.weixin.qq.com/s/ITJlhJrY_IWB8KH1cEbE2w" target="_blank" rel="noopener noreferrer">ä»ç†è®ºåˆ°å®è·µï¼šæ·±åº¦è§£è¯»BIOã€NIOã€AIOçš„ä¼˜ç¼ºç‚¹åŠä½¿ç”¨åœºæ™¯ -- ç´¢ç ç†</a> å¯¹æ–‡ç« å†…æè¿°è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼Œæœ¬æœºé‡è·‘äº†ä»£ç ï¼Œéšè—äº†ç¾å¥³å›¾ç‰‡ ğŸ¤£</p></blockquote><p>BIOã€NIO å’Œ AIO æ˜¯Javaç¼–ç¨‹è¯­è¨€ä¸­ç”¨äºå¤„ç†è¾“å…¥è¾“å‡ºï¼ˆIOï¼‰æ“ä½œçš„ä¸‰ç§ä¸åŒçš„æœºåˆ¶ï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨åŒæ­¥é˜»å¡I/Oï¼ŒåŒæ­¥éé˜»å¡I/Oå’Œå¼‚æ­¥éé˜»å¡I/Oã€‚</p><h2 id="bio" tabindex="-1"><a class="header-anchor" href="#bio"><span>BIO</span></a></h2><p><code>BIOï¼ˆBlocking IOï¼‰</code> æ˜¯æœ€ä¼ ç»Ÿçš„IOæ¨¡å‹ï¼Œä¹Ÿç§°ä¸ºåŒæ­¥é˜»å¡IOã€‚å®ƒå®ç°çš„æ˜¯åŒæ­¥é˜»å¡æ¨¡å‹ï¼Œå³æœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚<br> å¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¹¶ä¸”çº¿ç¨‹åœ¨è¿›è¡ŒIOæ“ä½œæœŸé—´æ˜¯è¢«é˜»å¡çš„ï¼Œæ— æ³•è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒBIOçš„æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œä¸”çº¿ç¨‹åˆ‡æ¢å¼€é”€è¾ƒå¤§ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ã€‚BIOé€‚åˆä¸€äº›ç®€å•çš„ã€ä½é¢‘çš„ã€çŸ­è¿æ¥çš„é€šä¿¡åœºæ™¯ï¼Œä¾‹å¦‚HTTPè¯·æ±‚ã€‚</p><p><img src="/img/java_bio.png" alt="BIOæ¨¡å‹"></p><h3 id="ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹"><span>ä¼˜ç¼ºç‚¹</span></a></h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><strong>ç®€å•æ˜“ç”¨ï¼š</strong> BIOæ¨¡å‹çš„ç¼–ç¨‹æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ã€‚</li><li><strong>å¯é æ€§é«˜ï¼š</strong> ç”±äºé˜»å¡ç‰¹æ€§ï¼ŒIOæ“ä½œçš„ç»“æœæ˜¯å¯é çš„ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><strong>é˜»å¡ç­‰å¾…ï¼š</strong> å½“ä¸€ä¸ªIOæ“ä½œè¢«é˜»å¡æ—¶ï¼Œçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚</li><li><strong>å¹¶å‘èƒ½åŠ›æœ‰é™ï¼š</strong> æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå½“è¿æ¥æ•°å¢åŠ æ—¶ï¼Œçº¿ç¨‹æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œé€ æˆèµ„æºæ¶ˆè€—å’Œæ€§èƒ½ä¸‹é™ã€‚</li><li>ç”±äºI/Oæ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥éœ€è¦ç­‰å¾…æœåŠ¡å™¨å“åº”ï¼Œä¼šé™ä½ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>BIO æœåŠ¡ç«¯</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BIOServer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Socket</span> clientSocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//åˆ›å»ºæœåŠ¡ç«¯</span></span>
<span class="line">            serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯å·²å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ¥æ”¶ä¸åˆ°è¯·æ±‚ä¼šä¸€ç›´ç­‰å¾…</span></span>
<span class="line">                clientSocket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">int</span> port <span class="token operator">=</span> clientSocket<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">InetAddress</span> inetAddress <span class="token operator">=</span> clientSocket<span class="token punctuation">.</span><span class="token function">getInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®¢æˆ·ç«¯ &quot;</span> <span class="token operator">+</span> inetAddress <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot; è¿æ¥æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//å¤„ç†å®¢æˆ·ç«¯æ¶ˆæ¯</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerHandler</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®¢æˆ·ç«¯è¿æ¥å¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>clientSocket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    clientSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>serverSocket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    serverSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³é—­èµ„æºå¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœåŠ¡ç«¯æ¶ˆæ¯å¤„ç†.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * BIO å¤„ç†æ¶ˆæ¯.</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">Socket</span> clientSocket<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ServerHandler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> clientSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>clientSocket <span class="token operator">=</span> clientSocket<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//è·å–å®¢æˆ·ç«¯è¾“å…¥æµä»¥ä¾¿æ¥æ”¶å®¢æˆ·ç«¯æ•°æ®</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">BufferedReader</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//è·å–å®¢æˆ·ç«¯è¾“å‡ºæµä»¥ä¾¿å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span>
<span class="line">            <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">int</span> port <span class="token operator">=</span> clientSocket<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">InetAddress</span> inetAddress <span class="token operator">=</span> clientSocket<span class="token punctuation">.</span><span class="token function">getInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> address <span class="token operator">=</span> inetAddress <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> port<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">String</span> inputLine<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>inputLine <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®¢æˆ·ç«¯&quot;</span> <span class="token operator">+</span> address <span class="token operator">+</span> <span class="token string">&quot;å‘æ¥æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> inputLine<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//ç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span>
<span class="line">                out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼š&quot;</span> <span class="token operator">+</span> inputLine<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * BIO å®¢æˆ·ç«¯ä»£ç .</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BIOClient</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Socket</span> clientSocket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">BufferedReader</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//ç»‘å®šæœåŠ¡ç«¯ipå’Œç«¯å£å·</span></span>
<span class="line">            clientSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥æœåŠ¡ç«¯æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//è·å–è¾“å…¥æµï¼Œæ¥æ”¶æœåŠ¡ç«¯æ¶ˆæ¯</span></span>
<span class="line">            in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//è·å–è¾“å‡ºæµ,ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span>
<span class="line">            out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">String</span> msg <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// è¾“å…¥ bye å°±é€€å‡º</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;bye&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token class-name">String</span> response<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>response <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//æ¥æ”¶æœåŠ¡ç«¯å“åº”</span></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯å“åº”ï¼š&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥æœåŠ¡ç«¯å¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>clientSocket <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    clientSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³é—­èµ„æºå¤±è´¥ï¼š&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><p>æœåŠ¡ç«¯çš„æ¶ˆæ¯</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">æœåŠ¡ç«¯å·²å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥<span class="token punctuation">..</span>.</span>
<span class="line">å®¢æˆ·ç«¯ /127.0.0.1:56827 è¿æ¥æˆåŠŸï¼</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:56827å‘æ¥æ¶ˆæ¯ï¼šhello server, I&#39;m tony</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:56827å‘æ¥æ¶ˆæ¯ï¼šå¹²å•¥å‘¢ï¼Œå‡ºæ¥å—¨ ğŸ’ƒ</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:56827å‘æ¥æ¶ˆæ¯ï¼šä¸å»ï¼Œæ‹‰åˆ°</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:56827å‘æ¥æ¶ˆæ¯ï¼šbye</span>
<span class="line">å®¢æˆ·ç«¯ /127.0.0.1:57198 è¿æ¥æˆåŠŸï¼</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:57198å‘æ¥æ¶ˆæ¯ï¼šæ–°æœåŠ¡ç«¯</span>
<span class="line">å®¢æˆ·ç«¯/127.0.0.1:57198å‘æ¥æ¶ˆæ¯ï¼šä½ å‡ºå»ç©ä¸</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯1</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">è¿æ¥æœåŠ¡ç«¯æˆåŠŸï¼</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šhello server, I<span class="token string">&#39;m tony</span>
<span class="line">æœåŠ¡ç«¯å“åº”ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼šhello server, I&#39;</span>m tony</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šå¹²å•¥å‘¢ï¼Œå‡ºæ¥å—¨ ğŸ’ƒ</span>
<span class="line">æœåŠ¡ç«¯å“åº”ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼šå¹²å•¥å‘¢ï¼Œå‡ºæ¥å—¨ ğŸ’ƒ</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šä¸å»ï¼Œæ‹‰åˆ°</span>
<span class="line">æœåŠ¡ç«¯å“åº”ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼šä¸å»ï¼Œæ‹‰åˆ°</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šbye</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°å¼€ä¸€ä¸ªï¼Œå®¢æˆ·ç«¯2</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">è¿æ¥æœåŠ¡ç«¯æˆåŠŸï¼</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šæ–°æœåŠ¡ç«¯</span>
<span class="line">æœåŠ¡ç«¯å“åº”ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼šæ–°æœåŠ¡ç«¯</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼šä½ å‡ºå»ç©ä¸</span>
<span class="line">æœåŠ¡ç«¯å“åº”ï¼šæœåŠ¡ç«¯å·²æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å›å¤ï¼šä½ å‡ºå»ç©ä¸</span>
<span class="line">ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼š</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç åªæ˜¯ç®€å•æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨BIOæ¨¡å‹ä¸€ä¸ªæœåŠ¡ç«¯æ¥æ”¶å¹¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚æƒ…å†µã€‚åœ¨è¿™é‡Œåˆ›å»ºäº†3ä¸ªç±»ï¼Œåˆ†åˆ«ä¸ºæœåŠ¡ç«¯ <code>BIOServer</code>ã€å¤šçº¿ç¨‹å®¢æˆ·ç«¯å¤„ç†ç±»<code>ServerHandler</code> å’Œ å®¢æˆ·ç«¯<code>BIOClient</code>ï¼Œæ¥ç€åˆ†åˆ«å¯åŠ¨æœåŠ¡ç«¯<code>BIOServer</code>å’Œä¸¤ä¸ªå®¢æˆ·ç«¯<code>BIOClient</code>ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä¸­æ¥æ”¶é”®ç›˜è¾“å…¥çš„å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼Œæœ€åæœåŠ¡ç«¯æŠŠæ¥æ”¶åˆ°çš„æ•°æ®å†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>ç”±äºBIOçš„ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯ä¸­éœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡çº¿ç¨‹æ± è¿›è¡Œä¼˜åŒ–ï¼Œè¿™é‡Œåªæ˜¯ç®€å•æ¼”ç¤ºä¸åšè¿‡å¤šè®¾è®¡ã€‚</p><h2 id="nio" tabindex="-1"><a class="header-anchor" href="#nio"><span>NIO</span></a></h2><p><code>NIO</code> æ˜¯Java 1.4å¼•å…¥çš„æ–°IOæ¨¡å‹ï¼Œä¹Ÿç§°ä¸ºåŒæ­¥éé˜»å¡IOï¼Œå®ƒæä¾›äº†ä¸€ç§åŸºäºäº‹ä»¶é©±åŠ¨çš„æ–¹å¼æ¥å¤„ç†I/Oæ“ä½œã€‚</p><p>ç›¸æ¯”äºä¼ ç»Ÿçš„BIOæ¨¡å‹ï¼ŒNIOé‡‡ç”¨äº†<code>Channel</code>ã€<code>Buffer</code>å’Œ<code>Selector</code>ç­‰ç»„ä»¶ï¼Œçº¿ç¨‹å¯ä»¥å¯¹æŸä¸ªIOäº‹ä»¶è¿›è¡Œç›‘å¬ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¸éœ€è¦é˜»å¡ç­‰å¾…ã€‚å½“IOäº‹ä»¶å°±ç»ªæ—¶ï¼Œçº¿ç¨‹ä¼šå¾—åˆ°é€šçŸ¥ï¼Œç„¶åå¯ä»¥è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†éé˜»å¡å¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œé€šä¿¡ã€‚åœ¨NIOæ¨¡å‹ä¸­ï¼Œæ•°æ®æ€»æ˜¯ä»Channelè¯»å…¥Bufferï¼Œæˆ–è€…ä»Bufferå†™å…¥Channelï¼Œè¿™ç§æ¨¡å¼æé«˜äº†IOæ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p><p>NIOä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šé€‰æ‹©å™¨ï¼ˆSelectorï¼‰ã€ç¼“å†²åŒºï¼ˆBufferï¼‰å’Œé€šé“ï¼ˆChannelï¼‰ã€‚Channelæ˜¯ä¸€ä¸ªå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™çš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½é€šè¿‡Bufferæ¥å¤„ç†ï¼Œè¿™ç§æ–¹å¼é¿å…äº†ç›´æ¥å°†å­—èŠ‚å†™å…¥é€šé“ä¸­ï¼Œè€Œæ˜¯å°†æ•°æ®å†™å…¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—èŠ‚çš„ç¼“å†²åŒºã€‚åœ¨å¤šçº¿ç¨‹æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè¿™æ˜¯é€šè¿‡å°†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œç„¶åç”±å¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿æ¥æœ‰I/Oè¯·æ±‚æ—¶è¿›è¡Œå¤„ç†ã€‚</p><p>å¯¹äºNIOï¼Œå¦‚æœä»ç‰¹æ€§æ¥çœ‹ï¼Œå®ƒæ˜¯éé˜»å¡å¼IOï¼ŒNæ˜¯Non-Blockingçš„æ„æ€ï¼›å¦‚æœä»æŠ€æœ¯è§’åº¦ï¼ŒNIOå¯¹äºBIOæ¥è¯´æ˜¯ä¸€ä¸ªæ–°æŠ€æœ¯ï¼ŒNçš„æ„æ€æ˜¯Newçš„æ„æ€ã€‚æ‰€ä»¥NIOä¹Ÿå¸¸å¸¸è¢«ç§°ä½œNon-Blocking I/Oæˆ–New I/Oã€‚</p><p>NIOé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œä¾‹å¦‚èŠå¤©æœåŠ¡å™¨ã€å¼¹å¹•ç³»ç»Ÿã€æœåŠ¡å™¨é—´é€šè®¯ç­‰ã€‚å®ƒé€šè¿‡å¼•å…¥éé˜»å¡é€šé“çš„æ¦‚å¿µï¼Œæé«˜äº†ç³»ç»Ÿçš„ä¼¸ç¼©æ€§å’Œå¹¶å‘æ€§èƒ½ã€‚åŒæ—¶ï¼ŒNIOçš„ä½¿ç”¨ä¹Ÿç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p><p><img src="/img/java_nio.png" alt="NIOæ¨¡å‹"></p><h3 id="ä¼˜ç¼ºç‚¹-1" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹-1"><span>ä¼˜ç¼ºç‚¹</span></a></h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><strong>é«˜å¹¶å‘æ€§ï¼š</strong> ä½¿ç”¨é€‰æ‹©å™¨ï¼ˆSelectorï¼‰å’Œé€šé“ï¼ˆChannelï¼‰çš„NIOæ¨¡å‹å¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸Šå¤„ç†å¤šä¸ªè¿æ¥ï¼Œæä¾›æ›´é«˜çš„å¹¶å‘æ€§èƒ½ã€‚</li><li><strong>èŠ‚çœèµ„æºï¼š</strong> ç›¸å¯¹äºBIOï¼ŒNIOéœ€è¦æ›´å°‘çš„çº¿ç¨‹æ¥å¤„ç†ç›¸åŒæ•°é‡çš„è¿æ¥ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºã€‚</li><li><strong>çµæ´»æ€§ï¼š</strong> NIOæä¾›äº†å¤šç§ç±»å‹çš„Channelå’ŒBufferï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚åˆçš„ç±»å‹ã€‚NIOå…è®¸å¼€å‘äººå‘˜è‡ªå®šä¹‰åè®®ã€ç¼–è§£ç å™¨ç­‰ç»„ä»¶ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li><li><strong>é«˜æ€§èƒ½ï¼š</strong> NIOé‡‡ç”¨äº†åŸºäºé€šé“å’Œç¼“å†²åŒºçš„æ–¹å¼æ¥è¯»å†™æ•°æ®ï¼Œè¿™ç§æ–¹å¼æ¯”ä¼ ç»Ÿçš„æµæ¨¡å¼æ›´é«˜æ•ˆã€‚å¯ä»¥å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚</li><li>**å†…å­˜ç®¡ç†ï¼š**NIOå…è®¸ç”¨æˆ·æ‰‹åŠ¨ç®¡ç†ç¼“å†²åŒºçš„å†…å­˜åˆ†é…å’Œå›æ”¶ï¼Œé¿å…äº†ä¼ ç»ŸI/Oæ¨¡å‹ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><strong>ç¼–ç¨‹å¤æ‚ï¼š</strong> ç›¸å¯¹äºBIOï¼ŒNIOçš„ç¼–ç¨‹æ–¹å¼æ›´åŠ å¤æ‚ï¼Œéœ€è¦ç†è§£é€‰æ‹©å™¨å’Œç¼“å†²åŒºç­‰æ¦‚å¿µï¼Œä¹Ÿéœ€è¦è€ƒè™‘å¤šçº¿ç¨‹å¤„ç†å’ŒåŒæ­¥é—®é¢˜ã€‚</li><li><strong>å¯é æ€§è¾ƒä½ï¼š</strong> NIOæ¨¡å‹ä¸­ï¼Œä¸€ä¸ªè¿æ¥çš„è¯»å†™æ“ä½œæ˜¯éé˜»å¡çš„ï¼Œæ— æ³•ä¿è¯IOæ“ä½œçš„ç»“æœæ˜¯å¯é çš„ï¼Œå¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†è¯»å†™æˆ–è€…é”™è¯¯çš„æ•°æ®ã€‚</li><li>NIOé€‚åˆä¸€äº›å¤æ‚çš„ã€é«˜é¢‘çš„ã€é•¿è¿æ¥çš„é€šä¿¡åœºæ™¯ï¼Œä¾‹å¦‚èŠå¤©å®¤ã€ç½‘ç»œæ¸¸æˆç­‰ã€‚</li></ul><h3 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>åœ¨çœ‹ä»£ç ä¹‹å‰å…ˆäº†è§£ NIO ä¸­3ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ï¼Œ<strong>é€‰æ‹©å™¨ï¼ˆSelectorï¼‰</strong>ã€<strong>ç¼“å†²åŒºï¼ˆBufferï¼‰</strong> å’Œ <strong>é€šé“ï¼ˆChannelï¼‰</strong>ï¼š</p><ul><li><p><strong>é€šé“ï¼ˆChannelï¼‰ï¼š</strong> Channel æ˜¯NIOä¸­ç”¨äºæ•°æ®è¯»å†™çš„åŒå‘é€šé“ï¼Œå¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥é€šé“ã€‚ä¸ä¼ ç»Ÿçš„IOä¸åŒï¼ŒChannelæ˜¯åŒå‘çš„ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œä¼ ç»Ÿçš„IOåªèƒ½é€šè¿‡ <strong>InputStream</strong> æˆ– <strong>OutputStream</strong> è¿›è¡Œå•å‘è¯»å†™ã€‚Java NIO ä¸­å¸¸è§çš„ Channel æœ‰ï¼š<strong>FileChannelï¼ˆæ–‡ä»¶è¯»å†™ï¼‰</strong>ã€<strong>DatagramChannelï¼ˆUDPåè®®ï¼‰</strong>ã€**SocketChannelï¼ˆTCPåè®®ï¼‰<strong>å’Œ</strong>ServerSocketChannelï¼ˆç›‘å¬TCPè¿æ¥è¯·æ±‚ï¼‰**ç­‰ã€‚</p></li><li><p><strong>ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼š</strong> Bufferæ˜¯ NIO ä¸­ç”¨äºå­˜å‚¨æ•°æ®çš„ç¼“å†²åŒºï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ä»ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚Bufferå…·æœ‰ä¸€ç»„æŒ‡é’ˆæ¥è·Ÿè¸ªå½“å‰ä½ç½®ã€é™åˆ¶å’Œå®¹é‡ç­‰å±æ€§ã€‚Java NIOä¸­æä¾›äº†å¤šç§ç±»å‹çš„Bufferï¼Œä¾‹å¦‚ <strong>ByteBuffer</strong>ã€<strong>CharBuffer</strong>ã€<strong>ShortBuffer</strong>ã€<strong>IntBuffer</strong>ç­‰ã€‚æ¯ç§ç±»å‹çš„Bufferéƒ½æœ‰è‡ªå·±ç‰¹å®šçš„è¯»å†™æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨<code>get()</code>å’Œ<code>put()</code>ç­‰æ–¹æ³•æ¥è¯»å†™ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</p></li><li><p><strong>é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ï¼š</strong> Selectoræ˜¯ NIO ä¸­ç”¨äºç›‘æ§å¤šä¸ª Channel çš„é€‰æ‹©å™¨ï¼Œå¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ªChannelã€‚Selectorå¯ä»¥æ£€æµ‹å¤šä¸ªChannelæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ŒåŒ…æ‹¬è¿æ¥ã€æ¥æ”¶ã€è¯»å–å’Œå†™å…¥ç­‰äº‹ä»¶ï¼Œå¹¶æ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹è¿›è¡Œç›¸åº”å¤„ç†ã€‚Selectorå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å•çº¿ç¨‹ç®¡ç†å¤šä¸ªChannelæ—¶çš„èµ„æºå ç”¨ï¼Œæé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p></li></ul><p>NIOçš„æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ‰“å¼€é€šé“å¹¶è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚</li><li>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶æŒ‡å®šæ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ï¼ˆå¦‚è¿æ¥æ‰“å¼€ã€å¯è¯»ç­‰ï¼‰ã€‚</li><li>çº¿ç¨‹é€šè¿‡è°ƒç”¨é€‰æ‹©å™¨çš„select()æ–¹æ³•ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚</li><li>å½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œçº¿ç¨‹å¯ä»¥ä»é€‰æ‹©å™¨ä¸­è·å–å·²ç»å‡†å¤‡å¥½çš„é€šé“ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„IOæ“ä½œã€‚</li><li>IOæ“ä½œå®Œæˆåï¼Œå…³é—­é€šé“å’Œé€‰æ‹©å™¨ã€‚</li></ol><p>ä¸‹é¢é€šè¿‡ä¸¤æ®µä»£ç å±•ç¤ºä¸€ä¸‹NIOçš„æ“ä½œæµç¨‹å’Œä½¿ç”¨æ–¹å¼ã€‚</p><p>æœåŠ¡ç«¯ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SocketChannel</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOServer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// åˆ›å»ºä¸€ä¸ªServerSocketChannelå¹¶ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£</span></span>
<span class="line">        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span></span>
<span class="line">        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// å°†ServerSocketChannelæ³¨å†Œåˆ°Selectorä¸Šï¼Œå¹¶ç›‘å¬OP_ACCEPTäº‹ä»¶</span></span>
<span class="line">        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// é˜»å¡ï¼Œç­‰å¾…äº‹ä»¶å‘ç”Ÿ</span></span>
<span class="line">            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selectedKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// å¤„ç†è¿æ¥è¯·æ±‚äº‹ä»¶</span></span>
<span class="line">                    <span class="token class-name">SocketChannel</span> client <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//ç›‘å¬OP_ACCEPTäº‹ä»¶</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">SocketChannel</span> client <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//åˆ†é…ç¼“å­˜åŒºå®¹é‡</span></span>
<span class="line">                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token class-name">Socket</span> socket <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">InetAddress</span> inetAddress <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">int</span> port <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> clientInfo <span class="token operator">=</span> inetAddress <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> port<span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥è‡ªå®¢æˆ·ç«¯ %s , æ¶ˆæ¯ï¼š%s&quot;</span><span class="token punctuation">,</span> clientInfo<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token function">responseMessage</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> client<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">responseMessage</span><span class="token punctuation">(</span><span class="token class-name">Selector</span> selector<span class="token punctuation">,</span> <span class="token class-name">SocketChannel</span> client<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//  é‡æ–°ç›‘å¬OP_ACCEPTäº‹ä»¶</span></span>
<span class="line">        client<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * <span class="token keyword">@author</span> å…¬ä¼—å·ï¼šç´¢ç ç†(suncodernote)</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOClient</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        socketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selectedKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">SocketChannel</span> client <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">isConnectionPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        client<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Enter message to server: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> message <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">SocketChannel</span> client <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: &quot;</span> <span class="token operator">+</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;è¾“å…¥æ¶ˆæ¯: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// å’ŒæœåŠ¡ç«¯ä»£ç ä¸€æ ·</span></span>
<span class="line">                    <span class="token function">writeMessage</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> client<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">è¿è¡Œç»“æœï¼š</span>
<span class="line"></span>
<span class="line">serverç«¯</span>
<span class="line">```shell</span>
<span class="line">æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯ <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">57698</span> <span class="token punctuation">,</span> æ¶ˆæ¯ï¼š<span class="token number">1</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯ <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">57698</span> <span class="token punctuation">,</span> æ¶ˆæ¯ï¼š<span class="token number">233</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯ <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">57678</span> <span class="token punctuation">,</span> æ¶ˆæ¯ï¼š<span class="token number">333</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯ <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">57678</span> <span class="token punctuation">,</span> æ¶ˆæ¯ï¼š<span class="token number">333</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯ <span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">57678</span> <span class="token punctuation">,</span> æ¶ˆæ¯ï¼š<span class="token number">333</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯-1</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Enter message to server: <span class="token number">333</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: <span class="token number">333</span></span>
<span class="line">è¾“å…¥æ¶ˆæ¯: <span class="token number">333</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: <span class="token number">333</span></span>
<span class="line">è¾“å…¥æ¶ˆæ¯: <span class="token number">333</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: <span class="token number">333</span></span>
<span class="line">è¾“å…¥æ¶ˆæ¯: </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯-2</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Enter message to server: <span class="token number">1</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: <span class="token number">1</span></span>
<span class="line">è¾“å…¥æ¶ˆæ¯: <span class="token number">233</span></span>
<span class="line">æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯: <span class="token number">233</span></span>
<span class="line">è¾“å…¥æ¶ˆæ¯: </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç æ–°å»ºäº†ä¸¤ä¸ªç±»ï¼šæœåŠ¡ç«¯ï¼ˆNIOServerï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆNIOClientï¼‰ï¼Œ é€šè¿‡ä¸Šé¢ä»£ç å’Œè¿è¡Œç»“æœå¯ä»¥å‘ç°ï¼Œåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ–°å»ºçº¿ç¨‹ç±»è¿›è¡Œé€šä¿¡ï¼Œè¿™ä¹Ÿæ˜¯ NIO å’Œ BIO æœ€å¤§çš„åŒºåˆ«ä¹‹ä¸€ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶NIOæé«˜äº†ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å’Œä¼¸ç¼©æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ›´é«˜çš„ç¼–ç¨‹å¤æ‚åº¦å’Œæ›´éš¾çš„è°ƒè¯•é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨Java NIOæ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘å…¶é€‚ç”¨åœºæ™¯å’Œç¼–ç¨‹æ¨¡å‹ã€‚</p><h2 id="aio" tabindex="-1"><a class="header-anchor" href="#aio"><span>AIO</span></a></h2><p>Java AIOï¼ˆAsynchronous I/Oï¼‰æ˜¯Javaæä¾›çš„å¼‚æ­¥éé˜»å¡IOç¼–ç¨‹æ¨¡å‹ï¼Œä»Java 7ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼ŒAIOåˆç§°NIO 2.0ã€‚</p><p>ç›¸æ¯”äºNIOæ¨¡å‹ï¼ŒAIOæ¨¡å‹æ›´è¿›ä¸€æ­¥åœ°å®ç°äº†å¼‚æ­¥éé˜»å¡IOï¼Œæé«˜äº†ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å’Œä¼¸ç¼©æ€§ã€‚åœ¨NIOæ¨¡å‹ä¸­ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å¤šè·¯å¤ç”¨å™¨å¤„ç†å¤šä¸ªè¿æ¥è¯·æ±‚ï¼Œä½†ä»éœ€è¦åœ¨æ¯ä¸ªè¿æ¥ä¸Šè¿›è¡Œè¯»å†™æ“ä½œï¼Œè¿™ä»ç„¶å­˜åœ¨ä¸€å®šçš„é˜»å¡ã€‚è€Œåœ¨AIOæ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„IOæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä»»ä½•çº¿ç¨‹ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p><p>AIOæ¨¡å‹æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li><strong>å¼‚æ­¥èƒ½åŠ›ï¼š</strong> AIOæ¨¡å‹çš„æœ€å¤§ç‰¹æ€§æ˜¯å¼‚æ­¥èƒ½åŠ›ï¼Œå¯¹äº socket å’Œ I/O æ“ä½œéƒ½æœ‰æ•ˆã€‚è¯»å†™æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå®Œæˆåä¼šè‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</li><li><strong>å›è°ƒå‡½æ•°ï¼š</strong> åœ¨AIOæ¨¡å‹ä¸­ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆåï¼Œä¼šé€šçŸ¥ç›¸å…³çº¿ç¨‹è¿›è¡Œåç»­å¤„ç†ï¼Œè¿™ç§å¤„ç†æ–¹å¼ç§°ä¸ºâ€œå›è°ƒâ€ã€‚å›è°ƒå‡½æ•°å¯ä»¥ç”±å¼€å‘è€…è‡ªè¡Œå®šä¹‰ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚</li><li><strong>éé˜»å¡ï¼š</strong> AIOæ¨¡å‹å®ç°äº†å®Œå…¨çš„å¼‚æ­¥éé˜»å¡IOï¼Œä¸ä¼šé˜»å¡ä»»ä½•çº¿ç¨‹ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</li><li><strong>é«˜æ€§èƒ½ï¼š</strong> ç”±äºAIOæ¨¡å‹çš„å¼‚æ­¥èƒ½åŠ›å’Œéé˜»å¡ç‰¹æ€§ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°å¤„ç†é«˜å¹¶å‘ã€é«˜ä¼¸ç¼©æ€§çš„ç½‘ç»œé€šä¿¡åœºæ™¯ï¼Œè¿›ä¸€æ­¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</li><li><strong>æ“ä½œç³»ç»Ÿæ”¯æŒï¼š</strong> AIOæ¨¡å‹éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œå› æ­¤åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå¯èƒ½ä¼šæœ‰ä¸åŒçš„è¡¨ç°ã€‚åœ¨Linuxå†…æ ¸2.6ç‰ˆæœ¬ä¹‹åå¢åŠ äº†å¯¹çœŸæ­£å¼‚æ­¥IOçš„å®ç°ã€‚</li></ul><h3 id="ä¼˜ç¼ºç‚¹-2" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹-2"><span>ä¼˜ç¼ºç‚¹</span></a></h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><strong>éé˜»å¡ï¼š</strong> AIOçš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒæ˜¯éé˜»å¡çš„ã€‚è¿™æ„å‘³ç€åœ¨è¯»å†™æ“ä½œè¿›è¡Œæ—¶ï¼Œç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½æœåŠ¡å™¨æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</li><li><strong>é«˜æ•ˆï¼š</strong> ç”±äºAIOå¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œå› æ­¤å®ƒé€šå¸¸æ¯”åŒæ­¥I/Oï¼ˆä¾‹å¦‚Javaçš„ä¼ ç»ŸI/Oå’ŒNIOï¼‰æ›´é«˜æ•ˆã€‚</li><li><strong>ç®€åŒ–ç¼–ç¨‹æ¨¡å‹ï¼š</strong> AIOä½¿ç”¨äº†å›è°ƒå‡½æ•°ï¼Œè¿™ä½¿å¾—ç¼–ç¨‹æ¨¡å‹ç›¸å¯¹ç®€å•ã€‚å½“ä¸€ä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œæ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨æ£€æŸ¥å’Œç­‰å¾…æ“ä½œçš„å®Œæˆã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><strong>å¤æ‚æ€§ï¼š</strong> è™½ç„¶AIOçš„ç¼–ç¨‹æ¨¡å‹ç›¸å¯¹ç®€å•ï¼Œä½†æ˜¯ç”±äºå…¶éé˜»å¡çš„ç‰¹æ€§ï¼Œç¼–ç¨‹å¤æ‚æ€§å¯èƒ½ä¼šå¢åŠ ã€‚ä¾‹å¦‚ï¼Œéœ€è¦å¤„ç†æ“ä½œå®Œæˆçš„é€šçŸ¥ï¼Œä»¥åŠå¯èƒ½çš„å¹¶å‘é—®é¢˜ã€‚</li><li><strong>èµ„æºæ¶ˆè€—ï¼š</strong> AIOå¯èƒ½ä¼šæ¶ˆè€—æ›´å¤šçš„ç³»ç»Ÿèµ„æºã€‚å› ä¸ºæ¯ä¸ªæ“ä½œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœå¹¶å‘è¿æ¥æ•°éå¸¸å¤§ï¼Œå¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚</li><li><strong>å¯ç§»æ¤æ€§ï¼š</strong> AIOåœ¨æŸäº›å¹³å°ä¸Šå¯èƒ½ä¸å¯ç”¨æˆ–è€…æ€§èƒ½ä¸ä½³ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦è·¨å¹³å°çš„å¯ç§»æ¤æ€§ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–I/Oæ¨¡å‹ã€‚</li></ul><p>AIOé€‚åˆä¸€äº›æç«¯çš„ã€è¶…é«˜é¢‘çš„ã€è¶…é•¿è¿æ¥çš„é€šä¿¡åœºæ™¯ï¼Œä¾‹å¦‚äº‘è®¡ç®—ã€å¤§æ•°æ®ç­‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰AIOæ¨¡å‹è¿˜æ²¡æœ‰å¹¿æ³›åº”ç”¨ï¼ŒNettyç­‰ç½‘ç»œæ¡†æ¶ä»ç„¶æ˜¯åŸºäº NIO æ¨¡å‹ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>æœåŠ¡ç«¯ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/**</span>
<span class="line"> * @author å…¬ä¼—å·ï¼šç´¢ç ç†(suncodernote)</span>
<span class="line"> */</span>
<span class="line">public class AIOServer {</span>
<span class="line">    public static void main(String[] args) throws Exception {</span>
<span class="line">        // åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥æœåŠ¡å™¨å¥—æ¥å­—é€šé“ï¼Œç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ä¸Š</span>
<span class="line">        final AsynchronousServerSocketChannel serverChannel = AsynchronousServerSocketChannel.open().bind(new InetSocketAddress(5000));</span>
<span class="line">        System.out.println(&quot;æœåŠ¡ç«¯å¯åŠ¨æˆï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚&quot;);</span>
<span class="line">        // å¼€å§‹æ¥å—æ–°çš„å®¢æˆ·ç«¯è¿æ¥</span>
<span class="line">        serverChannel.accept(null, new CompletionHandler&lt;AsynchronousSocketChannel, Void&gt;() {</span>
<span class="line">            @Override</span>
<span class="line">            public void completed(AsynchronousSocketChannel clientChannel, Void att) {</span>
<span class="line">                // å½“ä¸€ä¸ªæ–°çš„è¿æ¥å®Œæˆæ—¶ï¼Œå†æ¬¡æ¥å—æ–°çš„å®¢æˆ·ç«¯è¿æ¥</span>
<span class="line">                serverChannel.accept(null, this);</span>
<span class="line"></span>
<span class="line">                // åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºæ¥è¯»å–æ•°æ®</span>
<span class="line">                ByteBuffer buffer = ByteBuffer.allocate(1024);</span>
<span class="line">                try {</span>
<span class="line">                    InetSocketAddress clientAddress = (InetSocketAddress) clientChannel.getRemoteAddress();</span>
<span class="line">                    InetAddress clientIP = clientAddress.getAddress();</span>
<span class="line">                    int clientPort = clientAddress.getPort();</span>
<span class="line">                    System.out.println(&quot;å®¢æˆ·ç«¯ &quot;+ clientIP + &quot;:&quot; + clientPort + &quot; è¿æ¥æˆåŠŸã€‚&quot;);</span>
<span class="line">                } catch (IOException e) {</span>
<span class="line">                    e.printStackTrace();</span>
<span class="line">                }</span>
<span class="line">                // ä»å¼‚æ­¥å¥—æ¥å­—é€šé“ä¸­è¯»å–æ•°æ®</span>
<span class="line">                clientChannel.read(buffer, buffer, new ReadCompletionHandler(clientChannel));</span>
<span class="line">            }</span>
<span class="line">            @Override</span>
<span class="line">            public void failed(Throwable exc, Void attachment) {</span>
<span class="line">                System.out.println(&quot;Failed to accept a connection&quot;);</span>
<span class="line">            }</span>
<span class="line">        });</span>
<span class="line">        // ä¿æŒæœåŠ¡å™¨å¼€å¯</span>
<span class="line">        Thread.sleep(Integer.MAX_VALUE);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯»å¤„ç†ç¨‹åºï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/**</span>
<span class="line"> * @author å…¬ä¼—å·ï¼šç´¢ç ç†(suncodernote)</span>
<span class="line"> */</span>
<span class="line">public class ReadCompletionHandler implements CompletionHandler&lt;Integer, ByteBuffer&gt; {</span>
<span class="line"></span>
<span class="line">    private AsynchronousSocketChannel channel;</span>
<span class="line"></span>
<span class="line">    public ReadCompletionHandler(AsynchronousSocketChannel channel) {</span>
<span class="line">        this.channel = channel;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    @Override</span>
<span class="line">    public void completed(Integer result, ByteBuffer attachment) {</span>
<span class="line">        // å½“è¯»å–å®Œæˆæ—¶ï¼Œåè½¬ç¼“å†²åŒºå¹¶æ‰“å°å‡ºæ¥</span>
<span class="line">        attachment.flip();</span>
<span class="line">        byte[] bytes = new byte[attachment.remaining()];</span>
<span class="line">        attachment.get(bytes);</span>
<span class="line">        System.out.println(&quot;æ”¶åˆ°çš„æ¶ˆæ¯: &quot; + new String(bytes , StandardCharsets.UTF_8));</span>
<span class="line">        attachment.clear();</span>
<span class="line"></span>
<span class="line">        // ä»é”®ç›˜è¯»å–è¾“å…¥</span>
<span class="line">        Scanner scanner = new Scanner(System.in);</span>
<span class="line">        System.out.print(&quot;è¾“å…¥æ¶ˆæ¯: &quot;);</span>
<span class="line">        String message = scanner.nextLine();</span>
<span class="line">        System.out.println();</span>
<span class="line">        // å†™å…¥æ•°æ®åˆ°å¼‚æ­¥å¥—æ¥å­—é€šé“</span>
<span class="line">        channel.write(ByteBuffer.wrap(message.getBytes()));</span>
<span class="line"></span>
<span class="line">        channel.read(attachment , attachment , new ReadCompletionHandler(channel));</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    @Override</span>
<span class="line">    public void failed(Throwable exc, ByteBuffer attachment) {</span>
<span class="line">        System.out.println(&quot;Failed to read message&quot;);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">/**</span>
<span class="line"> * @author å…¬ä¼—å·ï¼šç´¢ç ç†(suncodernote)</span>
<span class="line"> */</span>
<span class="line">public class AIOClient {</span>
<span class="line">    public static void main(String[] args) throws Exception {</span>
<span class="line">        // åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥å¥—æ¥å­—é€šé“</span>
<span class="line">        AsynchronousSocketChannel clientChannel = AsynchronousSocketChannel.open();</span>
<span class="line"></span>
<span class="line">        // è¿æ¥åˆ°æœåŠ¡å™¨</span>
<span class="line">        clientChannel.connect(new InetSocketAddress(&quot;localhost&quot;, 5000), null, new CompletionHandler&lt;Void, Void&gt;() {</span>
<span class="line">            @Override</span>
<span class="line">            public void completed(Void result, Void attachment) {</span>
<span class="line">                System.out.println(&quot;è¿æ¥åˆ°æœåŠ¡ç«¯æˆåŠŸã€‚&quot;);</span>
<span class="line">            }</span>
<span class="line">            @Override</span>
<span class="line">            public void failed(Throwable exc, Void attachment) {</span>
<span class="line">                System.out.println(&quot;Failed to connect server&quot;);</span>
<span class="line">            }</span>
<span class="line">        });</span>
<span class="line">        </span>
<span class="line">        // ä»é”®ç›˜è¯»å–è¾“å…¥</span>
<span class="line">        Scanner scanner = new Scanner(System.in);</span>
<span class="line">        System.out.print(&quot;å‘é€æ¶ˆæ¯: &quot;);</span>
<span class="line">        String message = scanner.nextLine();</span>
<span class="line"></span>
<span class="line">        // å†™å…¥æ•°æ®åˆ°å¼‚æ­¥å¥—æ¥å­—é€šé“</span>
<span class="line">        clientChannel.write(ByteBuffer.wrap(message.getBytes()), null, new CompletionHandler&lt;Integer, Void&gt;() {</span>
<span class="line">            @Override</span>
<span class="line">            public void completed(Integer result, Void attachment) {</span>
<span class="line">                ByteBuffer buffer = ByteBuffer.allocate(1024);</span>
<span class="line">                clientChannel.read(buffer, buffer, new ReadCompletionHandler(clientChannel));</span>
<span class="line">            }</span>
<span class="line">            @Override</span>
<span class="line">            public void failed(Throwable exc, Void attachment) {</span>
<span class="line">                System.out.println(&quot;Failed to write message&quot;);</span>
<span class="line">            }</span>
<span class="line">        });</span>
<span class="line"></span>
<span class="line">        // ä¿æŒå®¢æˆ·ç«¯å¼€å¯</span>
<span class="line">        Thread.sleep(Integer.MAX_VALUE);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªæœåŠ¡ç«¯(AIOServer)å’Œ3ä¸ªå®¢æˆ·ç«¯(AIOClient)çš„é€šä¿¡ï¼Œç®€å•æ¼”ç¤ºäº†AIOçš„ä½¿ç”¨ã€‚å¯ä»¥å‘ç°ï¼ŒAIOå’ŒNIOçš„ä½¿ç”¨æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼Œæ•°æ®éƒ½æ˜¯ä»Channelè¯»å…¥Bufferï¼Œæˆ–è€…ä»Bufferå†™å…¥Channelä¸­ï¼Œä¸åŒçš„æ˜¯AIOæ˜¯å®ç°äº†å¼‚æ­¥éé˜»å¡ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>Javaä¸­çš„BIOã€NIOå’ŒAIOéƒ½æ˜¯å¤„ç†è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ“ä½œçš„æ¨¡å‹ï¼Œä½†å®ƒä»¬åœ¨å¤„ç†æ–¹å¼å’Œæ•ˆç‡ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><ul><li><p><strong>BIOï¼ˆBlocking I/Oï¼‰ï¼š</strong> BIOæ˜¯æœ€ä¼ ç»Ÿçš„I/Oæ¨¡å‹ï¼Œå®ƒçš„æ“ä½œéƒ½æ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å‘èµ·ä¸€ä¸ªI/Oæ“ä½œåï¼Œå¿…é¡»ç­‰å¾…æ“ä½œå®Œæˆæ‰èƒ½è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚å› æ­¤ï¼ŒBIOåœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶æ•ˆç‡è¾ƒä½ï¼Œä½†å…¶ç¼–ç¨‹æ¨¡å‹ç®€å•ã€‚</p></li><li><p><strong>NIOï¼ˆNon-blocking I/Oï¼‰ï¼š</strong> NIOæ˜¯éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œå®ƒå…è®¸çº¿ç¨‹åœ¨ç­‰å¾…I/Oæ“ä½œå®Œæˆæ—¶è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚NIOå¼•å…¥äº†Channelå’ŒBufferçš„æ¦‚å¿µï¼Œä»¥åŠSelectorç”¨äºå¤šè·¯å¤ç”¨ã€‚NIOé€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œä½†å…¶ç¼–ç¨‹æ¨¡å‹ç›¸å¯¹å¤æ‚ã€‚</p></li><li><p><strong>AIOï¼ˆAsynchronous I/Oï¼‰ï¼š</strong> AIOæ˜¯çœŸæ­£çš„å¼‚æ­¥I/Oæ¨¡å‹ï¼Œåº”ç”¨ç¨‹åºæ— éœ€ç­‰å¾…I/Oæ“ä½œçš„å®Œæˆï¼Œå½“æ“ä½œå®Œæˆæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚AIOä½¿ç”¨å›è°ƒå‡½æ•°æˆ–Futureå¯¹è±¡æ¥è·å–æ“ä½œç»“æœï¼Œé€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œå…¶ç¼–ç¨‹æ¨¡å‹ç›¸å¯¹ç®€å•ã€‚</p></li></ul><p>æ€»ä¹‹ï¼ŒBIOã€NIOå’ŒAIOå„æœ‰ä¼˜ç¼ºç‚¹ï¼Œé€‚ç”¨çš„åœºæ™¯ä¹Ÿä¸åŒã€‚BIOé€‚åˆè¿æ¥æ•°ç›®è¾ƒå°‘ä¸”å›ºå®šçš„æ¶æ„ï¼ŒNIOé€‚åˆè¿æ¥æ•°ç›®å¤šï¼Œä½†æ˜¯å¹¶å‘è¯»å†™æ“ä½œç›¸å¯¹è¾ƒå°‘çš„åœºæ™¯ï¼ŒAIOåˆ™é€‚åˆè¿æ¥æ•°ç›®å¤šï¼Œä¸”å¹¶å‘è¯»å†™æ“ä½œä¹Ÿå¤šçš„åœºæ™¯ã€‚åœ¨é€‰æ‹©ä½¿ç”¨å“ªç§I/Oæ¨¡å‹æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚è¿›è¡Œæƒè¡¡ã€‚</p><h2 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ"><span>å‚è€ƒ</span></a></h2><ul><li><a href="https://mp.weixin.qq.com/s/ITJlhJrY_IWB8KH1cEbE2w" target="_blank" rel="noopener noreferrer">ä»ç†è®ºåˆ°å®è·µï¼šæ·±åº¦è§£è¯»BIOã€NIOã€AIOçš„ä¼˜ç¼ºç‚¹åŠä½¿ç”¨åœºæ™¯ -- ç´¢ç ç†</a></li><li><a href="https://mp.weixin.qq.com/s/xl1kl2eF4cKWWsEvyeEWgg" target="_blank" rel="noopener noreferrer">é€è¿‡ç°è±¡çœ‹Java AIOçš„æœ¬è´¨ -- å¾—ç‰©æŠ€æœ¯</a></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ljathit@gmail.com">riverliu</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CANv46FP.js" defer></script>
  </body>
</html>
